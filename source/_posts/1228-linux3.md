---
title: 1228-linux3
comments: true
copyright: true
abbrlink: 2c01ed8b
date: 2021-12-28 00:44:15
updated: 2021-12-28 00:44:15
tags: 
  - Linux
  - Shell
categories: 计算机科学
keywords: Linux
description: Linux 基础学习第三部分：文件压缩、文件内容查找与替换、文件目录查找
top_img: https://download.mariozzj.cn/img/picgo/202112152228655.png
cover: https://download.mariozzj.cn/img/picgo/202112152228655.png
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
katex: false
aside: true
---
# 文件文本字符查找替换

## `grep`

`grep` 命令用于查找文件里符合条件的字符串行，即如果发现某文件包含符合指定范本样式的内容，就把那一行显示出来。

用法：`grep [-abcEFGhHilLnqrsvVwxy][-A<显示行数>][-B<显示列数>][-C<显示列数>][-e<范本样式>][-f<范本文件>][--help][范本样式][文件或目录...]`

参数：

* `-A <显示行数>`：除了显示结果行之外并展示该行之后的内容（同 `--after-context=<显示行数>`）
* `-B <显示行数>`：除了显示结果行之外并展示该行之前的内容（同 `--before-context=<显示行数>`）
* `-C <显示行数>`：除了显示结果行之外并展示该行之前之后的内容（同 `--context=<显示行数>`）
* `-e <范本样式>`：指定字符串作为查找文件内容的样式（同 `--regexp=<范本样式>`），见 [正则表达式 – 语法 | 菜鸟教程 (runoob.com)](https://www.runoob.com/regexp/regexp-syntax.html)
* `-f <规则文件>`：指定规则文件，其内容含有一个或多个规则样式，让 grep 查找符合规则条件的文件内容，格式为每行一个规则样式。
* `-i`：忽略字符大小写（同 `--ignore-case`）
* `-l`：仅输出符合指定样式的文件名称
* `-n`：在显示符合样式的那一行之前，标示出该行的列数编号
* `-r`：以递归方式查找符合条件的文献（查找目录及子目录，同 `--recursive` 或 `-d recurse`）
* `-v`：反向查找，打印出不符合条件行的内容（同 `--invert-match`）



应用举例：

系统报警显示了时间，但是日志文件太大无法直接 cat 查看。(查询含有特定文本的文件，并拿到这些文本所在的行)

```shell
grep -n '2019-10-24 00:01:11' *.log
```



在当前目录里第一级文件夹中寻找包含指定字符串的 .in 文件

```shell
grep "thermcontact" /.in
```



从根目录开始查找所有扩展名为 .log 的文本文件，并找出包含 "ERROR" 的行：

```shell
find / -type f -name "*.log" | xargs grep "ERROR"
```



例子：从当前目录开始查找所有扩展名为 .in 的文本文件，并找出包含 "thermcontact" 的行：

```shell
find . -name "*.in" | xargs grep "thermcontact"
```



## `sed`

`sed` 命令可用来自动编辑一个或多个文件，简化对文件的反复操作。

用法：`sed [-hnV][-e <script>][-f <script文件>][文本文件]`

参数：

* `-e`：以选项中指定的 script 处理输入的文本文件
* `-f`：以选项中指定的 script 文件来处理输入的文本文件
* `-n`：仅显示 script 处理后的结果

动作说明：

* `a`：新增， `a` 的后面接字符串，这些字符串会在新的一行出现
* `c`：取代， `c` 的后面接字符串，这些字符串可以取代 n1,n2 之间的行！
* `d`：删除
* `i`：插入， `i` 的后面接字符串，这些字符串会在新的一行出现(目前的上一行)
* `p`：打印，亦即将某个选择的数据印出。通常 `p` 会与参数 `sed -n` 一起运行
* `s`：取代，可以直接进行取代的工作哩！通常这个 `s` 的动作可以搭配正规表示法

动作举例：

```shell
# 删除某行
sed -e '1d' ab         #删除第一行 
sed -e '$d' ab         #删除最后一行
sed -e '1,2d' ab       #删除第一行到第二行
sed -e '2,$d' ab       #删除第二行到最后一行

　　# 显示某行
sed -e '1p' ab         #显示第一行 
sed -e '$p' ab         #显示最后一行
sed -e '1,2p' ab       #显示第一行到第二行
sed -e '2,$p' ab       #显示第二行到最后一行

　　# 使用模式进行查询
sed -e '/ruby/p' ab    #查询包括关键字ruby所在所有行
sed -e '/\$/p' ab      #查询包括关键字$所在所有行，使用反斜线\屏蔽特殊含义

　　# 增加一行或多行字符串
cat ab
Hello!
ruby is me,welcome to my blog.
end
sed -e '1a drink tea' ab  #第一行后增加字符串"drink tea"
Hello!
drink tea
ruby is me,welcome to my blog. 
end
sed -e '1,3a drink tea' ab #第一行到第三行后增加字符串"drink tea"
Hello!
drink tea
ruby is me,welcome to my blog.
drink tea
end
drink tea
sed -e '1a drink tea\nor coffee' ab   #第一行后增加多行，使用换行符\n
Hello!
drink tea
or coffee
ruby is me,welcome to my blog.
end

# 　　代替一行或多行
sed -e '1c Hi' ab                #第一行代替为Hi
Hi
ruby is me,welcome to my blog.
end
sed -e '1,2c Hi' ab             #第一行到第二行代替为Hi
Hi
end

# 替换一行中的某部分
# 格式：sed 's/要替换的字符串/新的字符串/g'   （要替换的字符串可以用正则表达式）
sed -n -e '/ruby/p' ab | sed 's/ruby/bird/g'    #替换ruby为bird
sed -n -e '/ruby/p' ab | sed 's/ruby//g'        #删除ruby

# 插入
sed -i '$a bye' ab         #在文件ab中最后一行直接输入"bye"
cat ab
Hello!
ruby is me,welcome to my blog.
end
bye

# 删除匹配行
# 格式：sed -i '/匹配字符串/d'  filename  （注：若匹配字符串是变量，则需要“”，而不是‘’。）

# 替换匹配行中的某个字符串
# 格式：sed -i '/匹配字符串/s/替换源字符串/替换目标字符串/g' filename
```

## 实战：字符串查找替换

1. 在 `/home/datawhale` 目录下昵称文件夹中，下载 https://mirror.coggle.club/dataset/jaychou_lyrics.txt.zip，并解压。
2. 使用 `grep` 完成下列操作，并输出到屏幕
   1. 统计歌词中 包含【超人】的歌词
   2. 统计歌词中 包含【外婆】但不包含【期待】的歌词
   3. 统计歌词中 以【我】开头的歌词
   4. 统计歌词中 以【我】结尾的歌词
3. 使用 `sed` 命令完成下列操作，并输出到屏幕
   1. 将歌词中 第2行 至 第40行 删除
   2. 将歌词中 所有【我】替换成【你】

实操：

1. 下载文件并解压

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ wget https://mirror.coggle.club/dataset/jaychou_lyrics.txt.zip
--2021-12-27 23:45:13--  https://mirror.coggle.club/dataset/jaychou_lyrics.txt.zip
Resolving mirror.coggle.club (mirror.coggle.club)... 113.229.252.249, 2408:872b:f01:1002:3::3fc
Connecting to mirror.coggle.club (mirror.coggle.club)|113.229.252.249|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 52607 (51K) [application/zip]
Saving to: ‘jaychou_lyrics.txt.zip’

100%[==============================================================================>] 52,607      --.-K/s   in 0.06s

2021-12-27 23:45:13 (880 KB/s) - ‘jaychou_lyrics.txt.zip’ saved [52607/52607]
[I have no name!@i-ym8u2kyp MarioZZJ]$ unzip -d . jaychou_lyrics.txt.zip
Archive:  jaychou_lyrics.txt.zip
inflating: ./jaychou_lyrics.txt
   ```

2. `grep` 文本匹配

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ grep -n "超人" jaychou_lyrics.txt
5795:如果超人会飞 那就让我在空中停一停歇
5798:不要问我哭过了没 因為超人不能流眼泪
5815:只能说当超人真的好难
5816:如果超人会飞 那就让我在空中停一停歇
5819:不要问我哭过了没 因為超人不能流眼泪
```

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ grep -n "外婆" jaychou_lyrics.txt | grep -v "期待"
579:我想带你 回我的外婆家
595:我想带你 回我的外婆家
2267:今天是外婆生日
2269:载着外婆开着拉风的古董车兜兜兜风
2274:外婆她脸上的涟漪
2288:外婆她的无奈
2294:记得去年外婆的生日
2295:表哥带我和外婆参加
2304:是因为看到外婆失落而失落
2313:我告诉外婆 我没输 不需要改变
2316:只要外婆觉得好听
2318:外婆露出了笑容 说她以我为荣
2327:外婆她的无奈
2339:外婆她的无奈
```

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ grep -n -e "^我" jaychou_lyrics.txt
5:我每天每天每天在想想想想著你
24:我每天每天每天在想想想想著你
51:我想要将我的寂寞封闭
### 太多了，略去部分输出
5788:我唱的歌词要有点文化 因為随时会被当教材
5811:我到底是一个创作歌手
```

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ grep -n -e "我$" jaychou_lyrics.txt
82:随风跟著我
120:你在那里 在小村外的溪边河口默默等著我
132:默默的在等著我
### 太多了，略去部分输出
5361:人群散了后 夜色多朦朧 月光也會跟著我
5365:人群散了后 夜色多朦朧 月光也會跟著我
```

3. `sed` 文本替换

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ sed -e '2,40d' jaychou_lyrics.txt
想要有直升机
透明的让我感动的可爱女人
坏坏的让我疯狂的可爱女人
### 省略其余输出
```

```shell
[I have no name!@i-ym8u2kyp MarioZZJ]$ sed -n -e '/我/p' jaychou_lyrics.txt | sed 's/我/你/g'
你每天每天每天在想想想想著你
让你开始乡相信命运
让你碰到你
漂亮的让你面红的可爱女人
### 太多了，省略部分输出
拯救地球好累 虽然有些疲惫 但你还是会
不要问你哭过了没 因為超人不能流眼泪
```

------------

# 文件目录查找

## `find`

## `locate`

## 实战：文件目录查找

1. 使用 `find` 统计文件系统中以 `py` 为后缀名的文件个数
2. 使用 `find` 寻找 `/home/` 文件夹下文件内容包含 datawhale 的文件
3. 使用 `locate` 寻找到 `python3.6.1.gz` 文件

实操：

1. 统计文件个数

```shell
[I have no name!@i-ym8u2kyp ~]$ find / -name "*.py" | wc -l # 使用 wc 对输出的换行符数进行统计，即可获知文件数量
find: ‘/proc/tty/driver’: Permission denied
find: ‘/proc/1/task/1/fd’: Permission denied
### 省略其他无权限报错
find: ‘/boot/grub2’: Permission denied
5907
```

2.   发现包含特定内容的文件

```shell
# 仅用 find 并不能根据文件内容发现文件，需要结合 grep 使用
[I have no name!@i-ym8u2kyp ~]$ find /home -type f -exec grep -l "datawhale" {} \;
/home/datawhale/.bash_history
/home/datawhale/jane/affairs.pyc
/home/datawhale/gjb/__pycache__/affairs.cpython-36.pyc
### 符合条件文件过多，省略部分输出
/home/datawhale/geyashi.tar
/home/datawhale/chen.tar
/home/datawhale/zyc.zip
[I have no name!@i-ym8u2kyp ~]$
```

3. 找到特定文件

```shell
[I have no name!@i-ym8u2kyp ~]$ locate python3.6.1.gz
/usr/share/man/man1/python3.6.1.gz
```
